## 整体介绍
为了满足业务快速接入，快速验证策略，拦截原因可追溯

* 整体架构

![image](https://github.com/huzhanchi/biz-risk/blob/main/images/biz-risk.png)

* 业务接入

把一种场景抽象为一个业务，赋予一个appid。业务方rpc风控查询时携带appid，以及通用主体字段：uid，ip，timestamp，appid，action，extra。其中extra为该场景下特有字段

* 配置模板化设计
将规则抽象成模板，防止配置出错；
规则抽象成模板，比如累计规则抽象出group by 条件，时间窗口。设置阀值，ttl，rediskey规范

* 规则与策略

累计规则，公共规则，私有规则
累计规则：是一种比较通用的计算规则，抽象出
公共规则：通用入口，如登录，进频道，关注等一些比较强的用户使用路径
私有规则：特定场景，比如一些活动等
黑白名单：明确一些可以放行的用户
运维事故降级：某些业务误将机房内部ip当作用户源ip传过来，导致ip规则误伤

* 策略执行

![image](https://github.com/huzhanchi/biz-risk/blob/main/images/juece.png)

* 灰度

针对业务场景有新的策略实施时，先将拦截开关关闭进入标记观察阶段，结合追溯和离线分析看效果决定是否实施新的策略。

* 追溯

在决策引擎综合规则，设备指纹，画像，情报打分，决定是否给予拦截。其中规则会给出具体规则id，当时生效规则版本；设备指纹，画像和情报给出具体细分类别组合掩码。

* 报障

追溯拦截原因，查看拦截依据，比如是否是物联网卡（电话核实），是否暴力注册等等，根据情况纠正。

* 一个业务接入上规则过程

创建一个appid，自动赋予公有规则，指定业务特殊私有规则，离线sql人工验证，上线规则进入标识观察阶段，调整策略，正式上线开启拦截，关注客服报障与解封。